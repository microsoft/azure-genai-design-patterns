## Description
This flow template is an advanced RAG flow modeled on the implementation of Azure AI Playground - on Your Data. The flow consists of tools that rewrites user query input into one or more queries based on chat history context using LLM, retrieves data for rewritten queries from the data index and generates a response from LLM by augmenting the prompt with retrieved data as well as chat history

## Flow Inputs
- User Query
- Chat History (automatically generated and maintained by the flow, if flow type is selected as Chat)

## Flow Outputs
- Reply: Response for the user query generated by LLM
- Documents: Collection of documents retrieved by querying the chosen data index with user query rewritten as the search input.

## Tools utilized in the flow
### formatRewriteIntentInputs
- Type: Python Tool
- Purpose: Prune the chat history based on max token and generate chat conversation to pass as in input to user query rewrite tool.

### rewriteIntent 
- Type: LLM Tool
- Purpose: Used to rewrite the user query, into one or more query, based on chat history context for more relevant retrievals.

### extractSearchIntent
- Type: Python Tool
- Purpose: Process the output of rewriteIntent and generated well-structured input for querySearchResource tool

### querySearchResource
- Type: Package
- Tool: promptflow_vectordb.tool.common_index_lookup.search
- Purpose: Retrieve Documents with the re-written queries from the data index and return top_k responses.

### chunkDocuments
- Type: Python Tool
- Purpose: Process the output of Retrieve Documents and chunk the retrieved documents on-the-fly.

### selectChunks
- Type: Python Tool
- Purpose: Select the chunks based on the scoring to use it as an input to LLM.

### shouldGenerateReply
- Type: Python Tool
- Purpose: Determine if Reply to be generated.

### formatGenerateReplyInput
- Type: Python Tool
- Purpose: Format the input, that will be augmented to prompt, to generate reply tool.

### generateReply
- Type: LLM Tool
- Purpose: Retrieve response from LLM with prompt input that includes retrieved documents and formatted chat history


## Prerequisites required to execute the flow
langdetect==1.0.9
promptflow-vectordb[azure] == 0.2.9
LLM Connection
Indexed Data